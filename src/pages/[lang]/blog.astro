---
import BaseLayout from '../../components/layout/BaseLayout.astro';
import CTASection from '../../components/sections/CTASection.astro';
import SectionTitle from '../../components/ui/SectionTitle.astro';
import { languagesList, getTranslations, urlStructure, type Language } from '../../lib/i18n';
import { Calendar, User, ArrowRight, ArrowLeft } from 'lucide-astro';

export function getStaticPaths() {
  return languagesList.map(lang => ({
    params: { lang },
    props: { lang }
  }));
}

const { lang } = Astro.props as { lang: Language };
const t = getTranslations(lang);
const isRTL = lang === 'ar';
const Arrow = isRTL ? ArrowLeft : ArrowRight;

// Blog posts data - fallback to empty array if not defined
const posts = t.blog.posts || [
  { title: 'Coming Soon', category: 'News', excerpt: 'Blog posts coming soon...', date: '2024', author: 'Nexify Team' }
];
const categoriesObj = t.blog.categories || {};
const categories = Object.values(categoriesObj);
---

<BaseLayout lang={lang} page="blog" title={`${t.nav.blog} | Nexify CRM Systems`} description={t.blog.hero.subtitle}>
  <!-- Hero -->
  <section class="py-20 bg-gradient-to-br from-white via-gray-50 to-teal-50/30">
    <div class="container mx-auto px-4 text-center">
      <span class="inline-block px-4 py-2 bg-primary/10 text-primary rounded-full text-sm font-medium mb-6">{t.blog.hero.badge}</span>
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">{t.blog.hero.title}</h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">{t.blog.hero.subtitle}</p>
    </div>
  </section>

  <!-- Blog Grid -->
  <section class="py-20 bg-white">
    <div class="container mx-auto px-4">
      <!-- Categories -->
      <div class="flex flex-wrap justify-center gap-4 mb-12">
        {categories.map((cat, index) => (
          <button 
            class={`px-6 py-2 rounded-full font-medium transition-colors ${index === 0 ? 'bg-primary text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}
          >
            {cat}
          </button>
        ))}
      </div>
      
      <!-- Featured Post -->
      <div class="mb-16">
        <div class="grid lg:grid-cols-2 gap-8 bg-gray-50 rounded-3xl overflow-hidden">
          <div class="h-64 lg:h-auto">
            <img 
              src="/images/project-1.png" 
              alt={posts[0]?.title || 'Featured Post'}
              class="w-full h-full object-cover"
            />
          </div>
          <div class={`p-8 lg:p-12 flex flex-col justify-center ${isRTL ? 'text-right' : 'text-left'}`}>
            <span class="inline-block px-3 py-1 bg-teal-500/10 text-teal-600 rounded-full text-sm font-medium mb-4 w-fit">
              {posts[0]?.category || 'Featured'}
            </span>
            <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 mb-4">{posts[0]?.title || 'Featured Article'}</h2>
            <p class="text-gray-600 mb-6">{posts[0]?.excerpt || 'Read our latest insights...'}</p>
            <div class={`flex items-center gap-4 text-sm text-gray-500 mb-6 ${isRTL ? 'flex-row-reverse' : ''}`}>
              <span class={`flex items-center gap-2 ${isRTL ? 'flex-row-reverse' : ''}`}>
                <Calendar class="w-4 h-4" />
                {posts[0]?.date || '2024'}
              </span>
              <span class={`flex items-center gap-2 ${isRTL ? 'flex-row-reverse' : ''}`}>
                <User class="w-4 h-4" />
                {posts[0]?.author || 'Nexify Team'}
              </span>
            </div>
            <a href="#" class={`inline-flex items-center gap-2 text-primary font-medium hover:underline ${isRTL ? 'flex-row-reverse' : ''}`}>
              {t.blog.read_more}
              <Arrow class="w-4 h-4" />
            </a>
          </div>
        </div>
      </div>
      
      <!-- Posts Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {posts.slice(1).map((post) => (
          <article class="bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all group">
            <div class="relative h-48 overflow-hidden">
              <img 
                src={post.image || '/images/project-2.png'}
                alt={post.title}
                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                loading="lazy"
              />
              <div class={`absolute top-4 ${isRTL ? 'left-4' : 'right-4'}`}>
                <span class="px-3 py-1 bg-white/90 backdrop-blur-sm rounded-full text-sm font-medium text-primary">
                  {post.category}
                </span>
              </div>
            </div>
            <div class={`p-6 ${isRTL ? 'text-right' : 'text-left'}`}>
              <div class={`flex items-center gap-4 text-sm text-gray-500 mb-3 ${isRTL ? 'flex-row-reverse' : ''}`}>
                <span class={`flex items-center gap-1 ${isRTL ? 'flex-row-reverse' : ''}`}>
                  <Calendar class="w-4 h-4" />
                  {post.date}
                </span>
              </div>
              <h3 class="text-lg font-bold text-gray-900 mb-2 line-clamp-2">{post.title}</h3>
              <p class="text-gray-600 text-sm mb-4 line-clamp-2">{post.excerpt}</p>
              <a href="#" class={`inline-flex items-center gap-2 text-primary font-medium text-sm hover:underline ${isRTL ? 'flex-row-reverse' : ''}`}>
                {t.blog.read_more}
                <Arrow class="w-4 h-4" />
              </a>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <CTASection 
    lang={lang}
    title={t.blog.cta_section.title}
    subtitle={t.blog.cta_section.subtitle}
    ctaPrimary={t.blog.cta_section.cta_primary}
  />
</BaseLayout>
