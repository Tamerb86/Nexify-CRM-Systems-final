---
import { languages, languagesList, type Language } from '../lib/i18n';
import '../styles/global.css';

// Map language configuration from i18n.ts to component format
const languageOptions = languagesList.map(code => ({
  code,
  name: languages[code].name,
  nativeName: languages[code].nativeName,
  flag: languages[code].flag
}));
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to Nexify CRM Systems | Choose Language</title>
  <meta name="description" content="Welcome to Nexify CRM Systems - Professional web development and SaaS solutions" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-teal-50">
  <div class="min-h-screen flex flex-col items-center justify-center p-4">
    <!-- Logo -->
    <div class="mb-8 animate-fade-in">
      <img 
        src="/images/nexify-logo.png" 
        alt="Nexify CRM Systems" 
        class="h-16 w-auto"
      />
    </div>

    <!-- Language Selection Card -->
    <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 animate-slide-up">
      <h1 class="text-2xl font-bold text-gray-900 text-center mb-2">
        Welcome to Nexify
      </h1>
      <p class="text-gray-600 text-center mb-8">
        Please select your preferred language
      </p>

      <!-- Language Options -->
      <div class="space-y-3">
        {languageOptions.map((lang) => (
          <a
            href={`/${lang.code}/`}
            class="flex items-center gap-4 p-4 rounded-xl border-2 border-gray-200 hover:border-indigo-500 hover:bg-indigo-50 transition-all duration-200 group"
          >
            <span class="text-3xl">{lang.flag}</span>
            <div class="flex-1">
              <div class="font-semibold text-gray-900 group-hover:text-indigo-600">
                {lang.nativeName}
              </div>
              <div class="text-sm text-gray-500">
                {lang.name}
              </div>
            </div>
            <svg 
              class="w-5 h-5 text-gray-400 group-hover:text-indigo-600 transition-colors" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        ))}
      </div>

      <!-- Auto-detection Message -->
      <div class="mt-6 p-4 bg-gray-50 rounded-lg">
        <p class="text-xs text-gray-600 text-center">
          Your language preference will be remembered for future visits
        </p>
      </div>
    </div>

    <!-- Footer -->
    <div class="mt-8 text-center text-sm text-gray-500">
      Â© 2025 Nexify CRM Systems AS. All rights reserved.
    </div>
  </div>

  <style>
    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slide-up {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in {
      animation: fade-in 0.6s ease-out;
    }

    .animate-slide-up {
      animation: slide-up 0.6s ease-out 0.2s both;
    }
  </style>

  <script>
    // Import language list from configuration
    import { languagesList } from '../lib/i18n';
    
    // Auto-detect browser language and redirect if not already set
    const hasVisited = localStorage.getItem('nexify-language-selected');
    
    if (!hasVisited) {
      const browserLang = navigator.language.toLowerCase().split('-')[0];
      
      // Handle Norwegian variants
      let detectedLang = 'no'; // default
      if (browserLang === 'nb' || browserLang === 'nn' || browserLang === 'no') {
        detectedLang = 'no';
      } else if (languagesList.includes(browserLang as any)) {
        detectedLang = browserLang;
      } else if (browserLang.startsWith('en')) {
        detectedLang = 'en';
      } else if (browserLang.startsWith('ar')) {
        detectedLang = 'ar';
      }
      
      // Set flag and redirect after a short delay to show the selection page
      localStorage.setItem('nexify-language-selected', 'true');
      setTimeout(() => {
        window.location.href = `/${detectedLang}/`;
      }, 1500);
    }

    // Track language selection
    document.querySelectorAll('a[href^="/"]').forEach(link => {
      link.addEventListener('click', () => {
        localStorage.setItem('nexify-language-selected', 'true');
      });
    });
  </script>
</body>
</html>
