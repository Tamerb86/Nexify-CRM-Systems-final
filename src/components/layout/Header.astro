---
import { languages, languagesList, urlStructure, getTranslations, getNavItems, type Language } from '../../lib/i18n';
import { Menu, X, ChevronDown, Globe } from 'lucide-astro';

interface Props {
  lang: Language;
  currentPage: string;
}

const { lang, currentPage } = Astro.props;
const t = getTranslations(lang);
const navItems = getNavItems(lang);
const langConfig = languages[lang];
const dir = langConfig.dir;

// Get alternate URLs for language switcher
const alternateUrls = languagesList.map(l => ({
  code: l,
  name: languages[l].nativeName,
  flag: languages[l].flag,
  url: urlStructure[l][currentPage]
}));
---

<header class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-gray-100">
  <div class="container mx-auto px-4">
    <nav class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a href={urlStructure[lang].home} class="flex items-center gap-3">
        <img src="/images/nexify-logo.png" alt="Nexify CRM Systems" class="h-10 w-auto" />
        <span class="text-xl font-bold text-primary hidden sm:block">Nexify</span>
      </a>
      
      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-8">
        {navItems.map(item => (
          <a 
            href={item.href}
            class={`text-sm font-medium transition-colors hover:text-primary ${
              currentPage === item.href.split('/').pop()?.replace(/[^a-z]/g, '') || 
              (currentPage === 'home' && item.href.endsWith('/'))
                ? 'text-primary' 
                : 'text-gray-600'
            }`}
          >
            {item.label}
          </a>
        ))}
      </div>
      
      <!-- Right Side: Language Switcher + CTA -->
      <div class="flex items-center gap-4">
        <!-- Language Switcher -->
        <div class="relative group">
          <button class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-600 hover:text-primary transition-colors">
            <Globe class="w-4 h-4" />
            <span>{langConfig.nativeName}</span>
            <ChevronDown class="w-4 h-4" />
          </button>
          
          <div class="absolute top-full right-0 mt-2 w-40 bg-white rounded-xl shadow-lg border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            {alternateUrls.map(alt => (
              <a 
                href={alt.url}
                class={`flex items-center gap-3 px-4 py-3 text-sm hover:bg-gray-50 transition-colors ${
                  alt.code === lang ? 'text-primary font-medium bg-primary/5' : 'text-gray-600'
                } ${alt.code === alternateUrls[0].code ? 'rounded-t-xl' : ''} ${alt.code === alternateUrls[alternateUrls.length - 1].code ? 'rounded-b-xl' : ''}`}
              >
                <span class="text-lg">{alt.flag}</span>
                <span>{alt.name}</span>
              </a>
            ))}
          </div>
        </div>
        
        <!-- CTA Button -->
        <a 
          href={urlStructure[lang].contact}
          class="hidden sm:inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-primary to-teal-500 text-white text-sm font-medium rounded-xl hover:opacity-90 transition-opacity"
        >
          {t.nav?.cta || 'Contact'}
        </a>
        
        <!-- Mobile Menu Button -->
        <button 
          id="mobile-menu-btn"
          class="lg:hidden p-2 text-gray-600 hover:text-primary transition-colors"
          aria-label="Toggle menu"
        >
          <Menu class="w-6 h-6" id="menu-icon" />
          <X class="w-6 h-6 hidden" id="close-icon" />
        </button>
      </div>
    </nav>
  </div>
  
  <!-- Mobile Navigation -->
  <div id="mobile-menu" class="lg:hidden hidden border-t border-gray-100 bg-white">
    <div class="container mx-auto px-4 py-4 space-y-2">
      {navItems.map(item => (
        <a 
          href={item.href}
          class={`block px-4 py-3 rounded-xl text-sm font-medium transition-colors ${
            currentPage === item.href.split('/').pop()?.replace(/[^a-z]/g, '') || 
            (currentPage === 'home' && item.href.endsWith('/'))
              ? 'text-primary bg-primary/5' 
              : 'text-gray-600 hover:bg-gray-50'
          }`}
        >
          {item.label}
        </a>
      ))}
      
      <!-- Mobile Language Switcher -->
      <div class="border-t border-gray-100 pt-4 mt-4">
        <p class="px-4 text-xs font-medium text-gray-400 uppercase mb-2">{t.nav?.language || 'Language'}</p>
        <div class="flex gap-2 px-4">
          {alternateUrls.map(alt => (
            <a 
              href={alt.url}
              class={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm ${
                alt.code === lang 
                  ? 'bg-primary text-white' 
                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
              }`}
            >
              <span>{alt.flag}</span>
              <span>{alt.name}</span>
            </a>
          ))}
        </div>
      </div>
      
      <!-- Mobile CTA -->
      <div class="pt-4">
        <a 
          href={urlStructure[lang].contact}
          class="block w-full text-center px-5 py-3 bg-gradient-to-r from-primary to-teal-500 text-white font-medium rounded-xl"
        >
          {t.nav?.cta || 'Contact'}
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');
  
  menuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
  });
</script>
